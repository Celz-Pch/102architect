#!/usr/bin/env python3
import sys
import math

def translation_matrix(i, j):
    print(f"Translation along vector ({i}, {j})")
    return [
        [1, 0, i],
        [0, 1, j],
        [0, 0, 1]
    ]

def scaling_matrix(m, n):
    print(f"Scaling by factors {m} and {n}")
    return [
        [m, 0, 0],
        [0, n, 0],
        [0, 0, 1]
    ]

def rotation_matrix(angle):
    print(f"Rotation by a {angle} degree angle")
    rad = math.radians(angle)
    return [
        [math.cos(rad), -math.sin(rad), 0],
        [math.sin(rad),  math.cos(rad), 0],
        [0, 0, 1]
    ]

def reflection_matrix(angle):
    print(f"Reflection over an axis with an inclination angle of {angle} degrees")
    rad = math.radians(2 * angle)
    return [
        [math.cos(rad), math.sin(rad), 0],
        [math.sin(rad), -math.cos(rad), 0],
        [0, 0, 1]
    ]


def multiply_matrices(a, b):
    res = [[0]*3 for _ in range(3)]
    for i in range(3):
        for j in range(3):
            res[i][j] = sum(a[i][k]*b[k][j] for k in range(3))
    return res

def apply_matrix(matrix, x, y):
    result = [
        matrix[0][0]*x + matrix[0][1]*y + matrix[0][2],
        matrix[1][0]*x + matrix[1][1]*y + matrix[1][2]
    ]
    return result

def print_matrix(matrix):
    for row in matrix:
        print(f"{row[0]:.2f}\t{row[1]:.2f}\t{row[2]:.2f}")

def main():
    if len(sys.argv) < 4:
        print("help")
        exit(84)

    x = float(sys.argv[1])
    y = float(sys.argv[2])
    args = sys.argv[3:]

    final_matrix = [
        [1, 0, 0],
        [0, 1, 0],
        [0, 0, 1]
    ]

    i = 0
    while i < len(args):
        if args[i] == "-t":
            matrix = translation_matrix(float(args[i+1]), float(args[i+2]))
            i += 3
        elif args[i] == "-z":
            matrix = scaling_matrix(float(args[i+1]), float(args[i+2]))
            i += 3
        elif args[i] == "-r":
            matrix = rotation_matrix(float(args[i+1]))
            i += 2
        elif args[i] == "-s":
            matrix = reflection_matrix(float(args[i+1]))
            i += 2
        else:
            exit(84)

        final_matrix = multiply_matrices(matrix, final_matrix)

    print_matrix(final_matrix)
    result = apply_matrix(final_matrix, x, y)
    print(f"({x:.2f}, {y:.2f}) => ({result[0]:.2f}, {result[1]:.2f})")

if __name__ == "__main__":
    main()
